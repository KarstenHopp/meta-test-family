#!/bin/bash
set -x
SERVICES="memcached baseruntime"
PTH="/usr/share/moduleframework/tools"

function runnomux(){
    SERVICE="$1"
    TYPE="$2"
    echo "> > > > SERVICE: $SERVICE"
    echo "> > > >   $TYPE based testing"
    (
        cd examples/$SERVICE
        $PTH/generator.py
        MODULE=$TYPE avocado run `ls $PTH/modulelint.py ./*.py ./*.sh`
    )
}

function runclassic(){
    TYPES="rpm docker"
    for SERVICE in $SERVICES; do
        for TYPE in $TYPES; do
            runnomux $SERVICE $TYPE
        done
    done
}

if [ -n "$2" ]; then
    runnomux "$1" "$2"
else
    runclassic
fi
